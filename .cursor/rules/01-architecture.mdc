---
alwaysApply: true
description: Core architecture and project structure patterns for the AI chatbot playground
---

# AI Chatbot Playground Architecture

This is a Next.js 15 AI chatbot application built with the AI SDK, featuring real-time streaming, artifacts generation, and multi-modal interactions.

## Project Structure

### Core Directories

- **[app/](mdc:app/)** - Next.js App Router with route groups
  - **[(auth)/](<mdc:app/(auth)/>)** - Authentication routes and logic
  - **[(chat)/](<mdc:app/(chat)/>)** - Chat interface and functionality
- **[components/](mdc:components/)** - Reusable UI components using shadcn/ui + Tailwind
- **[lib/](mdc:lib/)** - Core application logic and utilities
  - **[ai/](mdc:lib/ai/)** - AI SDK integration, models, tools, and prompts
  - **[db/](mdc:lib/db/)** - Database schema, queries, and Drizzle ORM setup
  - **[artifacts/](mdc:lib/artifacts/)** - Artifact system server-side logic
- **[artifacts/](mdc:artifacts/)** - Artifact system implementation (text, code, image, sheet)
- **[hooks/](mdc:hooks/)** - Custom React hooks for reusable logic

### Route Organization

- Uses **route groups** `(auth)` and `(chat)` for logical organization without affecting URL structure
- **Server Actions** in dedicated `actions.ts` files for server-side operations
- **API routes** follow RESTful patterns with proper error handling

## Key Technologies

### Frontend Stack

- **Next.js 15** with App Router and React Client Components
- **AI SDK v5** for chat functionality with streaming and tool calling
- **shadcn/ui + Tailwind CSS** for UI components and styling
- **Offline-First** with localStorage persistence and cache-first loading
- **User Settings** database-backed preferences with optimistic updates
- **TypeScript** throughout for type safety

### Backend Stack

- **Drizzle ORM + PostgreSQL** for data persistence
- **Auth.js v5** for authentication (free + pro users)
- **Razorpay** for payments and subscription management
- **Server Actions** for database operations
- **Usage tracking** for message limits and billing

### AI Integration

- **AI SDK v5 with Gateway** - Unified provider access
- **Dynamic model management** - Capability-based features
- **Tool calling** with structured schemas using Zod
- **Streaming responses** with real-time data updates
- **Multi-modal inputs** supporting text, images, and files
- **Usage-aware rate limiting** - Message count enforcement

## Core Patterns

### Component Architecture

- **Client components** marked with `'use client'` for all interactive features
- **Settings-aware components** with session props and user preferences hooks
- **Cache-first data loading** with localStorage persistence
- **Custom hooks** for settings, cache, and offline-first patterns
- **Type-safe props** with proper TypeScript interfaces

### State Management

- **React hooks** (useState, useEffect) for local component state
- **SWR** for cache-first server state with optimistic updates
- **User settings** database-backed preferences with cross-session persistence
- **localStorage** for offline-first data persistence
- **Custom hooks** for settings, cache, and complex logic abstraction
- **Context providers** for global state (DataStream, Theme, Settings)

### Data Flow

- **Cache-first loading** with localStorage persistence and background sync
- **Server Actions** for mutations and database operations
- **API routes** with centralized authentication decorators
- **User settings** database-backed preferences with optimistic updates
- **Real-time streaming** with usage tracking updates
- **Optimistic updates** with SWR mutations and automatic rollback
- **Message-based billing** with real-time limit enforcement

### Authentication Architecture

- **Route Access Control** - Centralized configuration in [lib/route-config.ts](mdc:lib/route-config.ts)
- **Auth Decorators** - Type-safe route handlers in [lib/auth-decorators.ts](mdc:lib/auth-decorators.ts)
- **Session Management** - Centralized configuration in [lib/auth/session-config.ts](mdc:lib/auth/session-config.ts)
- **Middleware Protection** - Edge-level auth enforcement in [middleware.ts](mdc:middleware.ts)

### Error Handling

- **Custom error classes** in [lib/errors.ts](mdc:lib/errors.ts)
- **Error boundaries** for graceful fallbacks
- **Toast notifications** for user feedback
- **Type-safe error responses** from API routes

## Development Guidelines

### File Naming

- Use **kebab-case** for file and directory names
- **PascalCase** for React components
- **camelCase** for functions and variables
- **UPPER_SNAKE_CASE** for constants

### Import Organization

- **External libraries** first
- **Internal modules** grouped by domain
- **Relative imports** last
- Use **path aliases** (@/) for cleaner imports

### Type Safety

- **Strict TypeScript** configuration
- **Infer types** from database schema using Drizzle
- **Zod schemas** for runtime validation
- **Proper generic usage** for reusable components

### Performance

- **Client components** with cache-first data loading
- **localStorage persistence** for offline-first experiences
- **Optimistic updates** for instant UI feedback
- **Dynamic imports** for large components
- **Image optimization** with Next.js Image component
- **Bundle analysis** and code splitting
